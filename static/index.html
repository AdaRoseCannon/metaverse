<html>
<html>
	<script src="scripts/aframe.js"></script>
</html>
<body>
	<script>
		AFRAME.registerComponent('wobble-normal', {
			schema: {
				variance: { default: 0.5 },
				amplitude: { default: 1 },
				offset: { default: 0 }
			},
			tick: function (t) {
				this.el.components.material.material.normalMap.offset.x += 0.00001 * Math.sin(t/10000);
				this.el.components.material.material.normalMap.offset.y += 0.00001 * Math.cos(t/8000);
				this.el.components.material.material.normalScale.x = this.data.offset + this.data.amplitude * (1-this.data.variance + this.data.variance * Math.cos(t/1000));
				this.el.components.material.material.normalScale.x = this.data.offset +this.data.amplitude * (1-this.data.variance + this.data.variance * Math.sin(t/1200));
			}
		});
		AFRAME.registerComponent('slide-normal', {
			schema: {},
			tick: function (t) {
				if (this.el.components.material.material && this.el.components.material.material.normalMap) this.el.components.material.material.normalMap.offset.y -= 0.0003;
			}
		});
	</script>
	<a-scene avatar-sync fog="type: exponential;">
		<a-assets>
			<img id="sky" src="images/CGSkies_0347_free.jpg"></img>
			<img id="water-normal" src="images/waternormals.jpg"></img>
			<img id="grid" src="images/grid.png"></img>
   			<a-asset-item id="fountain" src="models/fountain.obj"></a-asset-item>
   			<a-asset-item id="theatre" src="models/theatre.obj"></a-asset-item>
		</a-assets>
		<a-entity id="avatar-container"></a-entity>

		<a-entity position="0 3.6 3">
			<a-camera user-height="0"></a-camera>
		</a-entity>

		<a-entity id="dynamic-content">
		</a-entity>

		<a-entity
			material="color: yellow; metalness: 0; roughness: 1;"
			obj-model="obj: #theatre;"
			position="0 5 0"
			rotation="0 160 0"
		></a-entity>

		<a-entity geometry="primitive:cylinder; radius: 3; height: 3;" position="0 1.5 0" material="color: white; roughness: 1;"></a-entity>

		<a-entity
			material="color: #8ab39f; metalness:1; roughness: 0.4; sphericalEnvMap: #sky; normalTextureRepeat: 0.6 0.6; normalMap: #water-normal;"
			obj-model="obj: #fountain;"
			position="0 -2 0"
			scale="5 3 5"
			slide-normal
		></a-entity>

		<a-entity material="color: white; roughness: 1;" geometry="primitive: plane; width: 5; height: 3;" position="0 5 5" rotation="0 180 0"></a-entity>

		<a-sky src="#sky" material="fog: false"></a-sky>
		<a-entity light="color: #4c7cc2; intensity: 0.8; type: ambient;"></a-entity>
		<a-entity light="color: #fffab7; intensity: 1.0" position="-5 1 0" id="sun"></a-entity>
		<a-entity rotation="-90 0 0"
			geometry="primitive: plane; width: 10000; height: 10000;"
			material="color: #8ab39f; metalness:1; roughness: 0.4; sphericalEnvMap: #sky; normalTextureRepeat: 200 200; normalMap: #water-normal;"
			wobble-normal="scale: 2; variance: 0.8; offset: -1;"
		></a-entity>
	</a-scene>
	<script src="scripts/main.js"></script>
</body>
</html>